from flask import Flask, render_template, request, redirect, jsonify
import json, os

app = Flask(__name__)

DATA_FILE = "data.json"


def load_data():
    if not os.path.exists(DATA_FILE):
        return {}
    with open(DATA_FILE, "r", encoding="utf-8") as f:
        return json.load(f)


def save_data(data):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=4)


@app.route("/")
def index():
    data = load_data()
    return render_template("index.html", data=data)


@app.route("/admin", methods=["GET", "POST"])
def admin():
    data = load_data()

    if request.method == "POST":
        data["problem"] = request.form.get("problem")
        data["solution"] = request.form.get("solution")
        data["why_us"] = request.form.get("why_us")
        data["roadmap"] = request.form.get("roadmap")
        data["implementation"] = request.form.get("implementation")

        # TEAM
        team_names = request.form.getlist("team_name[]")
        team_roles = request.form.getlist("team_role[]")
        team_skills = request.form.getlist("team_skills[]")
        team_links = request.form.getlist("team_link[]")

        data["team"] = []
        for i in range(len(team_names)):
            if team_names[i].strip():
                data["team"].append({
                    "name": team_names[i],
                    "role": team_roles[i],
                    "skills": team_skills[i],
                    "link": team_links[i],
                })

        save_data(data)
        return redirect("/admin")

    return render_template("admin.html", data=data)


if __name__ == "__main__":
    app.run(debug=True)
